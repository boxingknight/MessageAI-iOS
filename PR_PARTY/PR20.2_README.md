# PR#20.2: Event Management - Quick Start Guide

**Status:** 📋 **DOCUMENTATION COMPLETE** (Ready for Implementation)  
**Time Estimate:** 6-8 hours  
**Complexity:** Medium  
**Priority:** 🔵 HIGH

---

## 🎯 **TL;DR** (30 seconds)

**What:** Add Info button → Opens Events Sheet → View/edit/cancel events

**Why:** Users can CREATE events (PR#20.1) but can't VIEW or MANAGE them

**How:** Apple Calendar-style sheet with event list + detail modal + edit/cancel

**Value:** Completes event lifecycle (create → view → manage)

---

## 📋 **What We're Building**

### **Problem**
After PR#20.1, users can create events via Ambient Bar, but:
- ❌ Can't view all events (past & future)
- ❌ Can't edit events (mistakes happen!)
- ❌ Can't cancel events (plans change!)
- ❌ No history (events disappear after Ambient Bar dismissed)

### **Solution**
**Info button** (top right of ChatView) → **Events Sheet** showing:
- All events (upcoming & past)
- Event details (date, time, location, RSVPs)
- Edit/cancel (creator only)
- Add to calendar (all users)
- Change RSVP (participants)

### **Design**
Apple Calendar style:
- Clean, minimalist list
- Tap event → Full details
- Clear roles (creator vs participant)

---

## 🎨 **What It Looks Like**

### **1. Info Button**
```
┌─────────────────────────────────┐
│ ← Chat Name          ⓘ AAA     │ ← Tap this!
├─────────────────────────────────┤
```

### **2. Events List Sheet**
```
┌─────────────────────────────────┐
│  Events                   [Done]│
├─────────────────────────────────┤
│  Upcoming (3)                   │
│  📅 Party - Oct 31 at 7PM       │
│  🏊 Swimming - Nov 2 at 1PM     │
│  🎮 Poker - Nov 5 at 9PM        │
│                                 │
│  Past (2)                       │
│  ⚽ Soccer - Oct 20              │
│  🎨 Playdate - Oct 18           │
└─────────────────────────────────┘
```

### **3. Event Detail Modal**
```
┌─────────────────────────────────┐
│  Event Details            [×]   │
├─────────────────────────────────┤
│  📅 Party                       │
│  October 31, 2025               │
│  7:00 PM                        │
│  📍 John's house                │
│                                 │
│  RSVP Status (5)                │
│  ✅ User1 (Yes)                 │
│  ✅ User2 (Yes)                 │
│  ❌ User3 (No)                  │
│                                 │
│  [📅 Add to Calendar]          │
│  [✏️ Edit Event]               │ ← Creator only
│  [🗑️ Cancel Event]             │ ← Creator only
└─────────────────────────────────┘
```

---

## ⚙️ **How It Works**

### **For All Users:**
1. Tap **Info button** (top right of chat)
2. See **all events** (upcoming & past)
3. Tap event → See **full details**
4. Tap **"Add to Calendar"** → Opens iOS Calendar

### **For Participants:**
5. Tap **"Change Response"** → Select Yes/No/Maybe

### **For Creator:**
5. Tap **"Edit Event"** → Change title/date/time/location
6. Tap **"Save"** → Updates for all users
7. Tap **"Cancel Event"** → Event cancelled (with confirmation)

---

## 🏗️ **What We're Building (Technical)**

### **New Files (7 files, ~1,000 lines)**

**Views:**
- `EventsListView.swift` (120 lines) - Main events sheet
- `EventRowView.swift` (80 lines) - Reusable row component
- `EventDetailView.swift` (200 lines) - Event detail modal
- `EventEditView.swift` (150 lines) - Edit modal (creator)

**ViewModels:**
- `EventsListViewModel.swift` (150 lines) - Events list logic
- `EventDetailViewModel.swift` (180 lines) - Event detail logic
- `EventEditViewModel.swift` (120 lines) - Edit logic

**Modified Files:**
- `ChatView.swift` (+10 lines) - Add Info button
- `EventDocument.swift` (+100 lines) - Add computed properties

---

## 📦 **Implementation Phases**

### **Phase 1: Basic Infrastructure** (2-3 hours)
**Goal:** Info button → Events List → Event Detail (read-only)

**Tasks:**
1. Add Info button to ChatView
2. Create EventsListView (with ViewModel)
3. Create EventRowView
4. Create EventDetailView (with ViewModel)
5. Test: View all events, tap to see details

**Success:** ✅ Can view all events and details

---

### **Phase 2: Calendar Integration** (1 hour)
**Goal:** "Add to Calendar" button works

**Tasks:**
1. Request calendar permissions (Info.plist)
2. Implement `addToCalendar()` in ViewModel
3. Create EKEvent from EventDocument
4. Test: Add event to iOS Calendar

**Success:** ✅ Event appears in iOS Calendar

---

### **Phase 3: RSVP Management** (1-2 hours)
**Goal:** Participants can change RSVP

**Tasks:**
1. Add "Change Response" button (participants only)
2. Show action sheet (Yes/No/Maybe)
3. Implement `changeRSVP()` in ViewModel
4. Update Firestore, refresh UI
5. Test: Change RSVP, see update on all devices

**Success:** ✅ RSVP changes work in real-time

---

### **Phase 4: Event Editing** (2-3 hours)
**Goal:** Creators can edit events

**Tasks:**
1. Create EventEditView (with ViewModel)
2. Add "Edit Event" button (creator only)
3. Implement `saveChanges()` in ViewModel
4. Send system message to chat
5. Test: Edit event, see update on all devices

**Success:** ✅ Edit updates work in real-time

---

### **Phase 5: Event Cancellation** (1 hour)
**Goal:** Creators can cancel events

**Tasks:**
1. Add "Cancel Event" button (creator only)
2. Show confirmation dialog
3. Implement `cancelEvent()` in ViewModel
4. Dismiss all Ambient Bars
5. Send system message to chat
6. Test: Cancel event, bars dismiss on all devices

**Success:** ✅ Cancel works, bars dismiss

---

### **Phase 6: Polish & Edge Cases** (1-2 hours)
**Goal:** Handle edge cases, loading states, errors

**Tasks:**
1. Add loading states (skeleton views)
2. Add empty states (no events)
3. Add error handling (network failures)
4. Add pull-to-refresh
5. Add badge count (Info button)
6. Test all edge cases

**Success:** ✅ Production-ready polish

---

## ✅ **Success Criteria**

**Functional:**
- ✅ Info button opens Events List
- ✅ Events split into Upcoming/Past
- ✅ Tap event → See details
- ✅ Add to Calendar works
- ✅ Edit event works (creator)
- ✅ Cancel event works (creator)
- ✅ Change RSVP works (participant)
- ✅ Real-time updates (<500ms)

**Quality:**
- ✅ Clean Apple-style UI
- ✅ Smooth animations
- ✅ Fast performance (<100ms to open)
- ✅ Handles errors gracefully
- ✅ Works offline (cached data)
- ✅ VoiceOver support

---

## ⚠️ **Edge Cases to Handle**

### **1. No Events**
**Scenario:** User taps Info button, no events exist

**Handling:** Show empty state: "No Events Yet"

---

### **2. Malformed Date/Time**
**Scenario:** Event has unparseable date ("this weekend")

**Handling:** Show original string, sort to bottom, don't crash

---

### **3. User Left Conversation**
**Scenario:** User removed from group, event still exists

**Handling:** Read-only mode, "You are no longer in this conversation"

---

### **4. Creator Left Conversation**
**Scenario:** Event creator left group

**Handling:** Event stays, no one can edit, show "Created by [User] (left)"

---

### **5. Network Failure**
**Scenario:** User opens Events sheet while offline

**Handling:** Show cached events, "Offline" indicator, disable edit/cancel

---

### **6. Calendar Permission Denied**
**Scenario:** User taps "Add to Calendar" but denied permission

**Handling:** Show alert: "Calendar access required", link to Settings

---

### **7. Cancelled Event**
**Scenario:** Event cancelled, still visible

**Handling:** Move to "Past" section, show "Cancelled" badge, dismiss Ambient Bars

---

## 🧪 **Testing Strategy**

### **Unit Tests**
- Date/time parsing (multiple formats)
- RSVP summary calculation
- Event sorting (upcoming/past)

### **Integration Tests**
- Fetch events from Firestore
- Edit event updates Firestore
- Cancel event updates status
- RSVP changes update Firestore

### **UI Tests**
- Open Events sheet
- Tap event → See details
- Edit event → Save
- Cancel event → Confirm

### **Manual Tests**
- End-to-end event lifecycle
- Two devices (real-time sync)
- Offline handling
- Permission handling
- Edge cases (malformed data, left conversation, etc.)

---

## 🚀 **Getting Started**

### **Prerequisites**
- ✅ PR#20.1 (Proactive Agent) merged
- ✅ Events can be created via Ambient Bar
- ✅ Firestore events collection exists
- ✅ No outstanding linter errors

### **Step 1: Create Branch**
```bash
git checkout main
git pull origin main
git checkout -b feature/pr20.2-event-management
```

### **Step 2: Read Documentation**
- ✅ Main Spec: `PR20.2_EVENT_MANAGEMENT.md` (45 min)
- ✅ Implementation Checklist: `PR20.2_IMPLEMENTATION_CHECKLIST.md` (30 min)
- ✅ This Quick Start: `PR20.2_README.md` (10 min)

**Total Reading Time:** 1.5 hours

### **Step 3: Start Phase 1**
- Follow checklist step-by-step
- Test after each task
- Commit frequently

### **Step 4: Test Thoroughly**
- Test each phase before moving to next
- Test on physical device
- Test with two devices (real-time sync)

### **Step 5: Deploy**
```bash
# Build for iPhone 17
# Test on device
# Commit changes
git add .
git commit -m "feat(events): PR#20.2 - Event Management (Solution 1)"
git push origin feature/pr20.2-event-management
```

---

## 🎯 **Decision Framework**

### **Should You Build This?**

**✅ Build It If:**
- You have 6-8 hours available
- PR#20.1 is complete and stable
- Users are creating events successfully
- You want to complete the event lifecycle
- You value a clean, Apple-style UI

**❌ Skip It If:**
- Time-constrained (<6 hours)
- PR#20.1 has outstanding bugs
- Other priorities (image sharing, notifications, etc.)
- Not interested in event management features

---

## 💡 **Pro Tips**

### **1. Build Vertically**
Complete each phase fully before moving to next. Don't have 6 half-working features.

### **2. Test After Each Task**
Don't wait until the end. Catch bugs early.

### **3. Use Preview Providers**
SwiftUI previews speed up UI development significantly.

### **4. Follow the Checklist**
The implementation checklist is designed to prevent bugs. Follow it step-by-step.

### **5. Commit Frequently**
Commit after each task. Makes it easy to revert if something breaks.

### **6. Test on Physical Device**
Simulators don't accurately represent performance or app lifecycle.

### **7. Test Real-Time Sync**
Use two devices in the same chat. Verify updates appear instantly (<500ms).

---

## 🐛 **Common Issues & Solutions**

### **Issue 1: Events Not Loading**
**Symptoms:** Empty state even though events exist

**Causes:**
- Firestore index not built
- Query missing `conversationId` filter
- Listener not attached

**Solutions:**
- Check Firebase console for index status
- Verify query in `EventsListViewModel.loadEvents()`
- Add logging: `print("Loading events for: \(conversationId)")`

---

### **Issue 2: Date/Time Parsing Fails**
**Symptoms:** Events show "distantPast" or crash

**Causes:**
- Unexpected date format
- Missing time component
- Timezone issues

**Solutions:**
- Add defensive parsing (try multiple formats)
- Return fallback value (don't crash)
- Log unparseable dates for debugging

---

### **Issue 3: Real-Time Updates Don't Work**
**Symptoms:** Second device doesn't see changes

**Causes:**
- Listener not attached
- Firestore offline mode
- Network issues

**Solutions:**
- Verify listener in `EventDetailViewModel.startListening()`
- Check Firestore logs in Firebase console
- Test with two devices on same network

---

### **Issue 4: Calendar Permission Denied**
**Symptoms:** "Add to Calendar" doesn't work

**Causes:**
- Missing Info.plist key
- User denied permission
- Wrong permission request

**Solutions:**
- Add `NSCalendarsFullAccessUsageDescription` to Info.plist
- Show alert if denied, link to Settings
- Test: Delete app, reinstall, grant permission

---

## 📊 **Estimated Timeline**

**Optimistic:** 6 hours (if everything goes smoothly)
**Realistic:** 8-10 hours (with testing and bug fixes)
**Pessimistic:** 12 hours (if major issues arise)

**Breakdown:**
- Phase 1: 2-3 hours (most complex)
- Phase 2: 1 hour (straightforward)
- Phase 3: 1-2 hours (RSVP logic)
- Phase 4: 2-3 hours (edit + system messages)
- Phase 5: 1 hour (cancel + bars dismiss)
- Phase 6: 1-2 hours (polish + edge cases)

---

## 🎉 **What You'll Have When Done**

### **For Users:**
- ✨ View all events (upcoming & past)
- ✨ Add events to iOS Calendar
- ✨ Edit events (fix mistakes)
- ✨ Cancel events (plans change)
- ✨ Change RSVP (update availability)
- ✨ See who's attending
- ✨ Professional, Apple-style UI

### **For Development:**
- 📱 7 new, reusable components
- 🏗️ Clean MVVM architecture
- ✅ Comprehensive error handling
- 🧪 Unit + integration + UI tests
- 📚 Excellent documentation
- 🚀 Production-ready code

---

## 🔗 **Related PRs**

- **PR#15:** Calendar Extraction (creates events from messages)
- **PR#18:** RSVP Tracking (tracks responses)
- **PR#20.1:** Proactive Agent (creates events via Ambient Bar)
- **PR#20.2:** Event Management (this PR - view/edit/cancel events)

**Together, these PRs create a complete event planning system! 🎉**

---

## 📞 **Need Help?**

**Review Documentation:**
1. Main Spec: `PR20.2_EVENT_MANAGEMENT.md` - Full details
2. Implementation Checklist: `PR20.2_IMPLEMENTATION_CHECKLIST.md` - Step-by-step tasks
3. Bug Analysis: `PR20.1_BUG_ANALYSIS.md` - Learn from past bugs

**Common Questions:**
- **"How do I parse dates?"** → See `EventDocument.swift` computed properties
- **"How do I listen to events?"** → See `EventsListViewModel.startListening()`
- **"How do I send system messages?"** → See `EventEditViewModel.sendSystemMessage()`

---

## ✅ **Ready to Build?**

**Checklist:**
- [ ] Read this Quick Start (10 min)
- [ ] Read Main Spec (45 min)
- [ ] Read Implementation Checklist (30 min)
- [ ] Create branch
- [ ] Start Phase 1
- [ ] Follow checklist step-by-step
- [ ] Test thoroughly
- [ ] Deploy & celebrate! 🎉

**Total Prep Time:** 1.5 hours reading + 8-10 hours implementation = **10-12 hours total**

**Let's build this! 🚀**

